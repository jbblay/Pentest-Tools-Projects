#!/usr/bin/env python

import optparse
import threading
from socket import *

def portScanner(target_host, target_port):
    try:
        target_IP = gethostbyname(target_host)
    except:
        print("Unknown Host", target_host)
        return

    try:
        target_Name = gethostbyaddr(target_IP)
        print("[+] Scan Results For:", target_Name[0])
    except:
        print("[+] Scan Results For:", target_IP)

    for port in target_port:
        t = threading.Thread(target=scanner, args=(target_host, int(port)))
        t.start()

def scanner(target_host, target_port):
    try:
        connection = socket(AF_INET, SOCK_STREAM)
        connection.settimeout(5)
        connection.connect((target_host, target_port))
        print(f"[+] Port {target_port} is open")
        banner = connection.recv(1024).decode().strip()
        print(f"[+] {target_host}/{target_port}: {banner}")
    except:
        pass
    finally:
        connection.close()


def main():
    parser = optparse.OptionParser("Usage of program: "+ "-H <target host> -P <target port>")
    parser.add_option("-H", dest="target_host",type="string",help="specify target host")
    parser.add_option("-p", dest="target_port",type="string",help="specify target ports separated by comma")
    (options, args) = parser.parse_args()
    target_host = options.target_host
    target_ports = str(options.target_port).split(',')
    if target_host == None or target_ports[0] == None:
        print(parser.usage)
        exit(0)
    portScanner(target_host, target_ports)

if __name__ == '__main__':
    main()
   